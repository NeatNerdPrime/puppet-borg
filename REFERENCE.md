# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

#### Public Classes

* [`borg`](#borg): Main class, includes all other classes.

#### Private Classes

* `borg::config`
* `borg::install`: This class handles the installation. Avoid modifying private classes.
* `borg::service`

## Classes

### <a name="borg"></a>`borg`

Main class, includes all other classes.

* **See also**
  * https://metacpan.org/pod/App::BorgRestore

#### Parameters

The following parameters are available in the `borg` class:

* [`package_name`](#-borg--package_name)
* [`create_prometheus_metrics`](#-borg--create_prometheus_metrics)
* [`use_upstream_reporter`](#-borg--use_upstream_reporter)
* [`update_borg_restore_db_after_backuprun`](#-borg--update_borg_restore_db_after_backuprun)
* [`manage_prune`](#-borg--manage_prune)
* [`keep_yearly`](#-borg--keep_yearly)
* [`keep_monthly`](#-borg--keep_monthly)
* [`keep_weekly`](#-borg--keep_weekly)
* [`keep_daily`](#-borg--keep_daily)
* [`keep_within`](#-borg--keep_within)
* [`compression`](#-borg--compression)
* [`working_directory`](#-borg--working_directory)
* [`source_paths`](#-borg--source_paths)
* [`excludes`](#-borg--excludes)
* [`includes`](#-borg--includes)
* [`backupserver`](#-borg--backupserver)
* [`install_restore_script`](#-borg--install_restore_script)
* [`restore_script_path`](#-borg--restore_script_path)
* [`backupdestdir`](#-borg--backupdestdir)
* [`backupdatadir`](#-borg--backupdatadir)
* [`absolutebackupdestdir`](#-borg--absolutebackupdestdir)
* [`manage_repository`](#-borg--manage_repository)
* [`exclude_pattern`](#-borg--exclude_pattern)
* [`additional_exclude_pattern`](#-borg--additional_exclude_pattern)
* [`restore_dependencies`](#-borg--restore_dependencies)
* [`package_ensure`](#-borg--package_ensure)
* [`additional_excludes`](#-borg--additional_excludes)
* [`additional_includes`](#-borg--additional_includes)
* [`username`](#-borg--username)
* [`ssh_port`](#-borg--ssh_port)
* [`borg_restore_version`](#-borg--borg_restore_version)
* [`install_fatpacked_cpanm`](#-borg--install_fatpacked_cpanm)
* [`proxy_type`](#-borg--proxy_type)
* [`proxy_server`](#-borg--proxy_server)
* [`manage_package`](#-borg--manage_package)
* [`ssh_key_type`](#-borg--ssh_key_type)
* [`backuptime`](#-borg--backuptime)
* [`ssh_proxyjump`](#-borg--ssh_proxyjump)
* [`wants`](#-borg--wants)
* [`requires`](#-borg--requires)
* [`after`](#-borg--after)
* [`pre_backup_script`](#-borg--pre_backup_script)
* [`post_backup_script`](#-borg--post_backup_script)
* [`restore_package`](#-borg--restore_package)

##### <a name="-borg--package_name"></a>`package_name`

Data type: `Variant[String[1],Array[String[1]]]`

Name of the borg package

##### <a name="-borg--create_prometheus_metrics"></a>`create_prometheus_metrics`

Data type: `Boolean`

Enable a postrun command to create prometheus compatible metrics about all backups

Default value: `true`

##### <a name="-borg--use_upstream_reporter"></a>`use_upstream_reporter`

Data type: `Boolean`

Enable to upstream reporter (see create_prometheus_metrics param) or our vendored version

Default value: `false`

##### <a name="-borg--update_borg_restore_db_after_backuprun"></a>`update_borg_restore_db_after_backuprun`

Data type: `Boolean`

Enable the restore helper from Florian 'Bluewind' Pritz (https://metacpan.org/release/App-BorgRestore) as another postrun command (see also the install_restore_script parameter)

Default value: `true`

##### <a name="-borg--manage_prune"></a>`manage_prune`

Data type: `Boolean`

Enable management of backup prunes. If this is set to `false` all `keep_*` parameters are ignored.

Default value: `true`

##### <a name="-borg--keep_yearly"></a>`keep_yearly`

Data type: `Integer[0]`

For how many years should we keep our backups?

Default value: `3`

##### <a name="-borg--keep_monthly"></a>`keep_monthly`

Data type: `Integer[0]`

For how many months should we keep our backups?

Default value: `24`

##### <a name="-borg--keep_weekly"></a>`keep_weekly`

Data type: `Integer[0]`

For how many weeks should we keep our backups?

Default value: `36`

##### <a name="-borg--keep_daily"></a>`keep_daily`

Data type: `Integer[0]`

For how many days should we keep our backups?

Default value: `60`

##### <a name="-borg--keep_within"></a>`keep_within`

Data type: `Integer[0]`

For how many days should we keep all backups we have?

Default value: `30`

##### <a name="-borg--compression"></a>`compression`

Data type: `String[1]`

Compression method and level to use. See the output of `borg help compression` for available options.

Default value: `'lz4'`

##### <a name="-borg--working_directory"></a>`working_directory`

Data type: `Stdlib::Absolutepath`

The working directory from where the backup should be created.

Default value: `'/'`

##### <a name="-borg--source_paths"></a>`source_paths`

Data type: `Array[String[1]]`

A list of relative or absolute paths to backup.

Default value: `['/']`

##### <a name="-borg--excludes"></a>`excludes`

Data type: `Array[Stdlib::Absolutepath]`

list of default mountpoints that should be excluded from backups. Every mountpoint needs to be explicitly excluded or included. See also the additional_excludes parameter.

Default value: `['/tmp', '/sys', '/dev', '/proc', '/run', '/media', '/var/lib/nfs/rpc_pipefs']`

##### <a name="-borg--includes"></a>`includes`

Data type: `Array[Stdlib::Absolutepath]`

list of default mountpoints that should be included from backups. Every mountpoint needs to be explicitly excluded or included. See also the additional_includes parameter.

Default value: `['/', '/boot', '/boot/efi', '/boot/EFI', '/var/log']`

##### <a name="-borg--backupserver"></a>`backupserver`

Data type: `String[1]`

FQDN for the remote server. Will be written into the local ssh client configuration file.

##### <a name="-borg--install_restore_script"></a>`install_restore_script`

Data type: `Boolean`

Install the restore helper via cpanm.

##### <a name="-borg--restore_script_path"></a>`restore_script_path`

Data type: `Stdlib::Absolutepath`

The path to the restore helper.

##### <a name="-borg--backupdestdir"></a>`backupdestdir`

Data type: `String[1]`

The path on the remote server where the backups should be written to. $username will be prepended

Default value: `'borg'`

##### <a name="-borg--backupdatadir"></a>`backupdatadir`

Data type: `Stdlib::Absolutepath`

The path where additional backup data should be stored.

Default value: `'/root/backup-data/'`

##### <a name="-borg--absolutebackupdestdir"></a>`absolutebackupdestdir`

Data type: `Optional[String[1]]`

By defaults, backups will be written on the remote host to $username/$backupdestdir. if $absolutebackupdestdir is set this will be used instead

Default value: `undef`

##### <a name="-borg--manage_repository"></a>`manage_repository`

Data type: `Boolean`

A Boolean that enables/disables repository management. Only true on Ubuntu 16.04 at the moment

##### <a name="-borg--exclude_pattern"></a>`exclude_pattern`

Data type: `Array[String[1]]`

We currently support excludes/includes for mountpoints. borg supports also a list of shell glob/regex pattern to filter for files.

Default value: `['sh:/home/*/.cache/*', 'sh:/root/.cache/*', 'sh:/var/cache/pacman/pkg/*']`

##### <a name="-borg--additional_exclude_pattern"></a>`additional_exclude_pattern`

Data type: `Array[String[1]]`

Another array of patterns to extend the modules built-in list (`exclude_pattern` parameter).

Default value: `[]`

##### <a name="-borg--restore_dependencies"></a>`restore_dependencies`

Data type: `Array[String[1]]`

A list of dependencies for the restore helper.

Default value: `[]`

##### <a name="-borg--package_ensure"></a>`package_ensure`

Data type: `String[1]`

Ensure state for the borg package.

Default value: `present`

##### <a name="-borg--additional_excludes"></a>`additional_excludes`

Data type: `Array[Stdlib::Absolutepath]`

Another array of mountpoints to extend the modules built-in list (`excludes` parameter).

Default value: `[]`

##### <a name="-borg--additional_includes"></a>`additional_includes`

Data type: `Array[Stdlib::Absolutepath]`

Another array of mountpoints to extend to modules built-in list (`includes` parameter).

Default value: `[]`

##### <a name="-borg--username"></a>`username`

Data type: `String[1]`

The ssh username to connect to the remote borg service.

Default value: `$facts['networking']['hostname']`

##### <a name="-borg--ssh_port"></a>`ssh_port`

Data type: `Stdlib::Port`

SSH port for the remote server (default: 22). Will be written into the local ssh client configuration file.

Default value: `22`

##### <a name="-borg--borg_restore_version"></a>`borg_restore_version`

Data type: `Pattern[/^\d*\.\d*\.\d*$/]`

Version for the perl script App::BorgRestore. change this version and the module will upgrade/downgrade it

Default value: `'3.4.4'`

##### <a name="-borg--install_fatpacked_cpanm"></a>`install_fatpacked_cpanm`

Data type: `Boolean`

cpanm is required on systems where we want to have App::BorgRestore. Legacy systems ship a too old cpanm version. For those operating systems we can install the upstream version.

##### <a name="-borg--proxy_type"></a>`proxy_type`

Data type: `Optional[Enum['none', 'ftp','http','https']]`

configue a network proxy *type* for the archive resources in this module. You also need to set `proxy_server` if you need a proxy.

Default value: `undef`

##### <a name="-borg--proxy_server"></a>`proxy_server`

Data type: `Optional[String[1]]`

Configurea network proxy for the archive resources in this module. By default no proxy will be used

Default value: `undef`

##### <a name="-borg--manage_package"></a>`manage_package`

Data type: `Boolean`

Enable/Disable management of the actual borg package. People on legacy OS or isolated environments can disable this and manage the binary in their profile.

Default value: `true`

##### <a name="-borg--ssh_key_type"></a>`ssh_key_type`

Data type: `Enum['rsa', 'ed25519']`

configure your most favourite ssh key type. This will be used to connect to the remote borg server.

Default value: `'ed25519'`

##### <a name="-borg--backuptime"></a>`backuptime`

Data type: `Hash[String[1],String[1]]`

Configure the name of each backupjob and the time of that job.

Default value: `{ 'default' => '18:30:00' }`

##### <a name="-borg--ssh_proxyjump"></a>`ssh_proxyjump`

Data type: `Optional[String[1]]`

Configure possible bastionhosts for the connection.

Default value: `undef`

##### <a name="-borg--wants"></a>`wants`

Data type: `Array[String[1]]`

Array of units where the borg-backup service should depend on

Default value: `['network-online.target']`

##### <a name="-borg--requires"></a>`requires`

Data type: `Array[String[1]]`

Array of units which the borg-backup service should require

Default value: `[]`

##### <a name="-borg--after"></a>`after`

Data type: `Array[String[1]]`

Array of units that should be started before the borg-backup service

Default value: `['network-online.target']`

##### <a name="-borg--pre_backup_script"></a>`pre_backup_script`

Data type: `Optional[String[1]]`

BASH code to be executed before the backup job starts. If you wish to use snapshots, create them here.

Default value: `undef`

##### <a name="-borg--post_backup_script"></a>`post_backup_script`

Data type: `Optional[String[1]]`

BASH code to be executed after the backup job has finished. If you need to perform any cleanup do so here.

Default value: `undef`

##### <a name="-borg--restore_package"></a>`restore_package`

Data type: `Optional[String[1]]`

Optional package name for the perl based script

Default value: `undef`

